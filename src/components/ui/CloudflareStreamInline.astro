---
interface Props {
  videoUID: string;
  class?: string;
}

const { videoUID, class: className } = Astro.props;
const customerCode = "kd8b2zcop4ozwi4i";
const videoSrc = `https://customer-${customerCode}.cloudflarestream.com/${videoUID}/iframe?autoplay=true&loop=true&muted=true&controls=false&preload=auto`;
---

<div class:list={["cloudflare-stream-inline-container", className]}>
  <iframe
    src={videoSrc}
    class="cloudflare-stream-inline"
    allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture;"
    allowfullscreen="true"
    loading="lazy"
    data-video-uid={videoUID}
  ></iframe>
</div>

<script src="https://embed.cloudflarestream.com/embed/sdk.latest.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const inlineVideo = document.querySelector('.cloudflare-stream-inline');
    if (inlineVideo && window['Stream']) {
      const player = window['Stream'](inlineVideo);
      
      // Configure for inline video behavior
      player.autoplay = true;
      player.loop = true;
      player.muted = true;
      player.controls = false;
      
      // Start playback with fallback to muted if autoplay fails
      player.play().catch(() => {
        player.muted = true;
        player.play();
      });
    }
  });
</script>

<style>
  .cloudflare-stream-inline-container {
    position: relative;
    padding-top: 56.25%; /* 16:9 Aspect Ratio */
    height: 0;
    overflow: hidden;
    border-radius: 0.5rem; /* rounded-lg equivalent */
  }
  
  .cloudflare-stream-inline {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none;
  }
</style>